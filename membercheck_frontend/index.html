<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">

    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.bootcss.com/qs/6.5.1/qs.min.js"></script>

    <style>
        .router-link-active {
            background-color: red;
        }

        .form-group {
            padding-left: 20%;
            padding-right: 20%;
        }
    </style>
</head>

<body>

    <template id="loginbox">
        <div class="mid">
            <div class="form-group">
                <label>username:</label>
                <input type="text" class="form-control" v-model="username" placeholder="Username">
            </div>
            <div class="form-group">
                <label>password:</label>
                <input type="password" class="form-control" v-model="pw">
                <button type="submit" class="btn btn-default" @click.prevent="trylogin">login</button>
            </div>
        </div>
    </template>

    <template id="regbox">
        <div class="mid">
            <div class="form-group">
                <label>username:</label>
                <input type="text" class="form-control" :value="username" placeholder="Username">
            </div>
            <div class="form-group">
                <label>password:</label>
                <input type="password" class="form-control" :value="pw">
                <button type="submit" class="btn btn-default">Submit</button>
            </div>
        </div>
    </template>

    <div id="app">
        <router-link to="/login?id=9">登录</router-link>
        <router-link to="/reg/10">注册</router-link>

        <router-view ></router-view>
        <a href="/admin.html">管理界面</a>
    </div>

    <script>
         axios.defaults.baseURL = 'http://127.0.0.1:8080';
         axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';

        var a = Vue.component('loginbox', {
            data(){
                return {
                    username:'',
                    pw:'',}
            },
            template: '#loginbox',
            methods: {
                trylogin() {
                    var jump='';
                    console.log("username",this.username);
                    console.log("pw",this.pw);
                    axios.post("/login",{},{params:{
                            name: this.username,
                            pw: this.pw}
                        })
                        .then(res => {
                            if(res.data.code == "404"){
                                console.log("no such user");
                            }else 
                            if(res.data.code == "444"){
                                console.log("wrong pw");
                            }
                        })
                        .catch(err => {
                            console.error(err);
                        });
                        
                },
            },
        });

        var b = Vue.component('regbox', {
            template: '#regbox',
            props:['username','pw'],
            template: '#loginbox',
            
        });


        const routerobj = new VueRouter({
            routes: [{
                    path: '/',
                    redirect: '/login',
                },
                {
                    path: '/login',
                    component: a,

                },
                {
                    path: '/reg/:id',
                    component: b,
                },
            ]
        });


        var vm = new Vue({
            el: '#app',
            data: {
                username: '',
                pw: '',
            },
            
            router: routerobj,
        })
    </script>
</body>

</html>